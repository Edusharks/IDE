import{S as r,J as ee,s as L,a as x,g as te,b as q,c as F,d as W,i as ne,e as z}from"./ide-tutorials-BlmyY8dx.js";const oe=""+new URL("ESP32-Dli2DnSJ.png",import.meta.url).href,ae=""+new URL("Pico-BBV_Q1mS.png",import.meta.url).href;document.addEventListener("DOMContentLoaded",()=>{r.init(),O(),ce();function v(){const e=document.getElementById("tech-bg");if(!e)return;const t=[{icon:"fa-microchip",type:"chip"},{icon:"fa-memory",type:"chip"},{icon:"fa-wifi",type:"iot"},{icon:"fa-brain",type:"ai"},{icon:"fa-robot",type:"ai"},{icon:"fa-code",type:"code"},{icon:"fa-bolt",type:"iot"},{icon:"fa-network-wired",type:"iot"}],n=25;for(let o=0;o<n;o++){const a=document.createElement("i"),c=t[Math.floor(Math.random()*t.length)];a.classList.add("fa-solid",c.icon,"tech-item",`type-${c.type}`);const s=Math.random()*2+1.5,i=Math.random()*100,l=Math.random()*15+15,f=Math.random()*20;a.style.fontSize=`${s}rem`,a.style.left=`${i}%`,a.style.animationDuration=`${l}s`,a.style.animationDelay=`-${f}s`,e.appendChild(a)}}v();function g(e,t,n){const o=document.getElementById("custom-prompt-modal"),a=document.getElementById("custom-prompt-message"),c=document.getElementById("custom-prompt-input"),s=document.getElementById("custom-prompt-ok"),i=document.getElementById("custom-prompt-cancel");a.textContent=e,c.value=t||"",o.style.display="flex",requestAnimationFrame(()=>o.classList.add("active")),c.focus();const l=()=>{o.classList.remove("active"),setTimeout(()=>o.style.display="none",300),s.onclick=null,i.onclick=null};s.onclick=()=>{const f=c.value.trim();f&&(l(),n&&n(f))},i.onclick=()=>{l(),n&&n(null)}}function I(e,t){const n=document.getElementById("custom-confirm-modal"),o=document.getElementById("custom-confirm-message"),a=document.getElementById("custom-confirm-yes"),c=document.getElementById("custom-confirm-no");o.textContent=e,n.style.display="flex",requestAnimationFrame(()=>n.classList.add("active"));const s=()=>{n.classList.remove("active"),setTimeout(()=>n.style.display="none",300),a.onclick=null,c.onclick=null};a.onclick=()=>{s(),t&&t(!0)},c.onclick=()=>{s(),t&&t(!1)}}const d=document.getElementById("projects-grid"),u=document.getElementById("examples-grid"),B=document.getElementById("tutorials-grid"),y=document.getElementById("new-project-modal"),w=document.getElementById("modal-project-name"),M=document.querySelector(".board-grid"),C=document.getElementById("modal-create-btn");let E=null,h=[],m=null;const G=[{id:"esp32",name:"ESP32",img:oe},{id:"pico",name:"Pico W",img:ae}],J=[{name:"Gesture Mouse",boardId:"esp32",desc:"Control mouse with AI hand tracking."},{name:"IoT Dashboard",boardId:"esp32",desc:"Wifi connected sensor monitor."},{name:"Physics Game",boardId:"simulation",desc:"Browser-based circuit simulation."}];function O(){const e=document.getElementById("tech-bg"),t=document.getElementById("animation-toggle"),n=i=>{e&&(e.style.display=i==="enabled"?"block":"none"),t&&(t.checked=i==="enabled")};r.get("animations")||r.set("animations","enabled");const o=r.get("animations");n(o),t&&(t.onchange=i=>{const l=i.target.checked?"enabled":"disabled";r.set("animations",l),n(l)}),r.get("theme")||r.set("theme","light");const a=r.get("color")||"#4f46e5",c=r.get("theme")||"light";$(a),T(c);const s=document.getElementById("settings-modal");document.getElementById("open-settings-btn").onclick=()=>{s.style.display="flex",requestAnimationFrame(()=>s.classList.add("active"))},document.getElementById("close-settings-btn").onclick=()=>{s.classList.remove("active"),setTimeout(()=>s.style.display="none",300)},document.querySelectorAll(".color-dot").forEach(i=>{i.onclick=()=>{const l=i.dataset.color;$(l),r.set("color",l)},i.dataset.color===a&&i.classList.add("active")})}function $(e){document.documentElement.style.setProperty("--primary",e),document.querySelectorAll(".color-dot").forEach(t=>{t.classList.toggle("active",t.dataset.color===e)})}function T(e){const t=document.getElementById("theme-btn-light"),n=document.getElementById("theme-btn-dark");t&&n&&(e==="light"?(t.classList.add("active"),n.classList.remove("active")):(t.classList.remove("active"),n.classList.add("active")))}window.setTheme=e=>{r.set("theme",e),T(e)};const Z=document.getElementById("import-project-btn"),b=document.getElementById("import-file-input");Z.onclick=()=>b.click(),b.onchange=async e=>{const t=e.target.files[0];if(t){try{let n=null;if(t.name.endsWith(".json")){const o=await t.text();n=JSON.parse(o)}else if(t.name.endsWith(".zip")){const a=await new ee().loadAsync(t),c=a.file("project.json");if(!c)throw new Error("Invalid Project: 'project.json' missing from zip.");const s=await c.async("string"),i=JSON.parse(s),l={},f=[];a.forEach((N,R)=>{if(!R.dir&&N!=="project.json"){const _=R.async("string").then(K=>{l[N]=K});f.push(_)}}),await Promise.all(f),n={...i,workspace:l}}else{alert("Please select a .json or .zip project file."),b.value="";return}if(!n.name||!n.boardId)throw new Error("Invalid project data structure");h.some(o=>o.name===n.name)?I(`Overwrite existing project "${n.name}"?`,async o=>{o&&await P(n)}):await P(n)}catch(n){console.error(n),alert("Import failed: "+n.message)}b.value=""}};async function P(e){const t=Date.now();await L({name:e.name,boardId:e.boardId,createdAt:t,modifiedAt:t,extensions:e.extensions||[],dashboard:e.dashboard||null,circuit:e.circuit||null,customModelLoaded:e.aiConfig?.customModelLoaded||!1,customModelUrl:e.aiConfig?.customModelUrl||null}),e.workspace&&await x(e.name,e.workspace),p()}function A(e){return e==="esp32"?'<i class="fa-solid fa-microchip"></i>':e==="pico"?'<i class="fa-solid fa-memory"></i>':'<i class="fa-solid fa-gamepad"></i>'}async function p(){h=await te();const e=document.getElementById("search-projects").value.toLowerCase(),t=document.getElementById("sort-projects").value;let n=h.filter(o=>o.name.toLowerCase().includes(e));n.sort((o,a)=>t==="name-asc"?o.name.localeCompare(a.name):a.modifiedAt-o.modifiedAt),Array.from(d.children).forEach(o=>{o.id!=="create-new-project-btn"&&o.remove()}),n.forEach(o=>{const a=document.createElement("div");a.className="card",a.innerHTML=`
                        <div class="card-top">
                            <div class="card-icon" style="background: var(--primary-light); color: var(--primary);">${A(o.boardId)}</div>
                            <button class="card-menu-btn" title="Options"><i class="fa-solid fa-ellipsis-vertical"></i></button>
                        </div>
                        <div class="card-content">
                            <h3>${o.name}</h3>
                            <p>${o.boardId==="simulation"?"Simulation":o.boardId.toUpperCase()}</p>
                            <div class="card-meta">Modified: ${new Date(o.modifiedAt).toLocaleDateString()}</div>
                        </div>
                    `,a.onclick=c=>{c.target.closest(".card-menu-btn")||H(o)},a.querySelector(".card-menu-btn").onclick=c=>{c.stopPropagation(),Y(c,o)},d.appendChild(a)})}function Q(){u.innerHTML="",J.forEach(e=>{const t=document.createElement("div");t.className="card",t.innerHTML=`
                        <div class="card-top">
                            <div class="card-icon" style="background:#e0f2fe; color:#0284c7;">${A(e.boardId)}</div>
                        </div>
                        <div class="card-content">
                            <span class="tag tag-blue">Example</span>
                            <h3>${e.name}</h3>
                            <p>${e.desc}</p>
                        </div>
                    `,t.onclick=()=>alert("Example cloning not implemented in demo."),u.appendChild(t)}),B.innerHTML="",ne.forEach(e=>{const t=document.createElement("div");t.className="card",t.innerHTML=`
                        <div class="card-top">
                            <div class="card-icon" style="background:#f3e8ff; color:#9333ea;">${e.icon}</div>
                        </div>
                        <div class="card-content">
                            <span class="tag tag-purple">Tutorial</span>
                            <h3>${e.title}</h3>
                            <p>${e.description}</p>
                        </div>
                    `,t.onclick=()=>V(e),B.appendChild(t)})}function V(e){D(),w.value=e.title,k()}function S(){M.innerHTML="",G.forEach(e=>{const t=document.createElement("div");t.className="board-option",E===e.id&&t.classList.add("selected"),t.innerHTML=`<img src="${e.img}"><h4>${e.name}</h4>`,t.onclick=()=>{E=e.id,S(),k()},M.appendChild(t)})}function k(){const e=w.value.trim();C.disabled=!(e&&E)}function D(){y.style.display="flex",setTimeout(()=>y.classList.add("active"),10),w.focus(),E=null,S(),k()}function X(){y.classList.remove("active"),setTimeout(()=>y.style.display="none",300)}C.onclick=async()=>{const e=w.value.trim();if(h.some(n=>n.name===e))return alert("Name taken!");const t={name:e,boardId:E,createdAt:Date.now(),modifiedAt:Date.now(),extensions:[],dashboard:null};await L(t),H(t)};const j=document.getElementById("project-context-menu");function Y(e,t){m=t,j.style.display="block";const n=Math.min(e.clientX,window.innerWidth-200);j.style.left=n+"px",j.style.top=e.clientY+"px",setTimeout(()=>document.addEventListener("click",U),10)}function U(){j.style.display="none",document.removeEventListener("click",U)}document.getElementById("ctx-delete").onclick=()=>{m&&I(`Delete project "${m.name}"?`,async e=>{e&&(await z(m.name),p())})},document.getElementById("ctx-rename").onclick=()=>{if(!m)return;const e=m.name;g("Rename project:",e,async t=>{if(t&&t!==e){if(h.some(c=>c.name===t))return alert("Name already exists.");const n=await q(e),o=await F(e);await z(e);const a={...m,name:t,modifiedAt:Date.now()};await L(a),n&&await x(t,n),o&&await W(t,o),p()}})},document.getElementById("ctx-duplicate").onclick=async()=>{if(!m)return;const e=m.name;let t=`${e} Copy`,n=1;for(;h.some(c=>c.name===t);)n++,t=`${e} Copy ${n}`;const o=await q(e),a=await F(e);await L({...m,name:t,createdAt:Date.now(),modifiedAt:Date.now()}),o&&await x(t,o),a&&await W(t,a),p()},document.getElementById("create-new-project-btn").onclick=D,document.getElementById("modal-cancel-btn").onclick=X,w.oninput=k,document.getElementById("search-projects").oninput=p,document.getElementById("sort-projects").onchange=p;function H(e){const t=e.boardId==="simulation"?`simulation-ide.html?project=${encodeURIComponent(e.name)}`:`ide.html?project=${encodeURIComponent(e.name)}&board=${encodeURIComponent(e.boardId)}`;window.location.href=t}p(),Q()});async function ce(){const v=document.getElementById("project-tutorials-grid");try{const g=await fetch("tutorials/index.json");if(!g.ok)throw new Error("Manifest not found");const I=await g.json();v.innerHTML="",I.forEach(d=>{const u=document.createElement("div");u.className="card",u.innerHTML=`
                <div class="card-top">
                    <div class="card-icon" style="background:var(--bg-inset); color:var(--text-main);">
                        <i class="fa-solid ${d.icon}"></i>
                    </div>
                </div>
                <div class="card-content">
                    <span class="tag ${d.color}">${d.level}</span>
                    <h3>${d.title}</h3>
                    <p>${d.description}</p>
                </div>
            `,u.onclick=()=>{const B=encodeURIComponent(d.title),y=encodeURIComponent(d.filename);window.location.href=`ide.html?board=esp32&project=${B}&tutorial=${y}`},v.appendChild(u)})}catch(g){console.error(g),v.innerHTML='<p style="color:var(--text-muted);">Failed to load tutorials.</p>'}}
