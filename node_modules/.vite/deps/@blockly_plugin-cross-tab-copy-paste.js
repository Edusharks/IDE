import {
  require_blockly_compressed
} from "./chunk-37NJYYKB.js";
import {
  __commonJS
} from "./chunk-PLDDJCW6.js";

// node_modules/@blockly/plugin-cross-tab-copy-paste/dist/index.js
var require_dist = __commonJS({
  "node_modules/@blockly/plugin-cross-tab-copy-paste/dist/index.js"(exports, module) {
    !(function(e, t) {
      if ("object" == typeof exports && "object" == typeof module) module.exports = t(require_blockly_compressed());
      else if ("function" == typeof define && define.amd) define(["blockly/core"], t);
      else {
        var o = "object" == typeof exports ? t(require_blockly_compressed()) : t(e.Blockly);
        for (var r in o) ("object" == typeof exports ? exports : e)[r] = o[r];
      }
    })(exports, (e) => (() => {
      "use strict";
      var t = { 370: (t2) => {
        t2.exports = e;
      } }, o = {};
      function r(e2) {
        var s2 = o[e2];
        if (void 0 !== s2) return s2.exports;
        var i2 = o[e2] = { exports: {} };
        return t[e2](i2, i2.exports, r), i2.exports;
      }
      r.n = (e2) => {
        var t2 = e2 && e2.__esModule ? () => e2.default : () => e2;
        return r.d(t2, { a: t2 }), t2;
      }, r.d = (e2, t2) => {
        for (var o2 in t2) r.o(t2, o2) && !r.o(e2, o2) && Object.defineProperty(e2, o2, { enumerable: true, get: t2[o2] });
      }, r.o = (e2, t2) => Object.prototype.hasOwnProperty.call(e2, t2), r.r = (e2) => {
        "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e2, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e2, "__esModule", { value: true });
      };
      var s = {};
      r.r(s), r.d(s, { CrossTabCopyPaste: () => l });
      var i, n = r(370);
      function a(e2) {
        return !!(n.isCopyable(e2) && n.isDeletable(e2) && n.isDraggable(e2)) && (e2.isCopyable ? e2.isCopyable() : e2 instanceof n.BlockSvg || e2 instanceof n.comments.RenderedWorkspaceComment ? e2.isOwnDeletable() && e2.isOwnMovable() : e2.isDeletable() && e2.isMovable());
      }
      function c(e2) {
        return a(e2) && n.isDeletable(e2) && e2.isDeletable();
      }
      !(function(e2) {
        e2.ENABLED = "enabled", e2.DISABLED = "disabled", e2.HIDDEN = "hidden";
      })(i || (i = {}));
      class l {
        constructor() {
          this.localStorageKey = "blocklyStash";
        }
        init({ contextMenu: e2 = true, shortcut: t2 = true } = { contextMenu: true, shortcut: true }, o2, r2) {
          r2 && (this.localStorageKey = r2), e2 && (this.blockCopyToStorageContextMenu(), this.blockPasteFromStorageContextMenu(o2)), t2 && (n.ShortcutRegistry.registry.unregister(n.ShortcutItems.names.COPY), n.ShortcutRegistry.registry.unregister(n.ShortcutItems.names.CUT), n.ShortcutRegistry.registry.unregister(n.ShortcutItems.names.PASTE), this.blockCopyToStorageShortcut(), this.blockCutToStorageShortcut(), this.blockPasteFromStorageShortcut(o2));
        }
        getCopyData() {
          const e2 = localStorage.getItem(this.localStorageKey);
          if (e2) return JSON.parse(e2);
        }
        copyPrecondition(e2, t2) {
          const o2 = e2.focusedNode;
          if (!o2) return i.HIDDEN;
          if (!n.isCopyable(o2)) return i.HIDDEN;
          if (t2 || (t2 = o2.workspace), !(t2 instanceof n.WorkspaceSvg)) return i.HIDDEN;
          const r2 = t2.isFlyout ? t2.targetWorkspace : t2;
          return o2 && r2 && !r2.isDragging() && !n.getFocusManager().ephemeralFocusTaken() && a(o2) ? i.ENABLED : i.DISABLED;
        }
        copyCallback(e2, t2) {
          const o2 = e2.focusedNode;
          if (!o2 || !n.isCopyable(o2) || !a(o2)) return false;
          if (!(t2 instanceof n.WorkspaceSvg)) return false;
          const r2 = t2.isFlyout ? t2.targetWorkspace : t2;
          if (!r2) return false;
          o2.workspace.isFlyout || r2.hideChaff();
          const s2 = o2.toCopyData();
          return !!s2 && (localStorage.setItem(this.localStorageKey, JSON.stringify(s2)), true);
        }
        pastePrecondition(e2) {
          const t2 = this.getCopyData();
          return t2 ? "typeCounts" in t2 && !(null == e2 ? void 0 : e2.isCapacityAvailable(t2.typeCounts)) || !e2 || e2.isReadOnly() || e2.isDragging() || n.getFocusManager().ephemeralFocusTaken() ? i.DISABLED : i.ENABLED : i.DISABLED;
        }
        getContextMenuText(e2) {
          return e2.indexOf(")") === e2.length - 1 && (e2 = e2.split(" (")[0]), e2;
        }
        blockCopyToStorageContextMenu() {
          const e2 = { displayText: () => n.Msg.CROSS_TAB_COPY ? n.Msg.CROSS_TAB_COPY : this.getContextMenuText(n.Msg.COPY_SHORTCUT), preconditionFn: (e3) => this.copyPrecondition(e3), callback: (e3) => {
            const t2 = e3.focusedNode;
            if (!t2 || !n.isCopyable(t2)) return false;
            const o2 = t2.workspace;
            return this.copyCallback(e3, o2);
          }, id: "blockCopyToStorage", weight: 0 };
          n.ContextMenuRegistry.registry.register(e2);
        }
        blockPasteFromStorageContextMenu(e2) {
          const t2 = { displayText: () => n.Msg.CROSS_TAB_PASTE ? n.Msg.CROSS_TAB_PASTE : this.getContextMenuText(n.Msg.PASTE_SHORTCUT), preconditionFn: (e3) => {
            if (!(e3.focusedNode instanceof n.WorkspaceSvg) || e3.focusedNode.isFlyout) return i.HIDDEN;
            const t3 = e3.focusedNode;
            return this.pastePrecondition(t3);
          }, callback: (t3, o2, r2, s2) => {
            const i2 = this.getCopyData();
            if (!i2) return false;
            const a2 = t3.focusedNode;
            if (!(a2 instanceof n.WorkspaceSvg)) return false;
            const c2 = n.utils.svgMath.screenToWsCoordinates(a2, s2);
            try {
              return !!n.clipboard.paste(i2, a2, c2);
            } catch (t4) {
              if (!(t4 instanceof TypeError && e2)) throw t4;
              e2();
            }
          }, id: "blockPasteFromStorage", weight: 0 };
          n.ContextMenuRegistry.registry.register(t2);
        }
        blockCopyToStorageShortcut() {
          const e2 = n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.C, [n.utils.KeyCodes.CTRL]), t2 = n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.C, [n.utils.KeyCodes.META]), o2 = { name: n.ShortcutItems.names.COPY, keyCodes: [e2, t2], preconditionFn: (e3, t3) => this.copyPrecondition(t3, e3) === i.ENABLED, callback: (e3, t3, o3, r2) => (t3.preventDefault(), this.copyCallback(r2, e3)) };
          n.ShortcutRegistry.registry.register(o2);
        }
        blockCutToStorageShortcut() {
          const e2 = n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.X, [n.utils.KeyCodes.CTRL]), t2 = n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.X, [n.utils.KeyCodes.META]), o2 = { name: n.ShortcutItems.names.CUT, keyCodes: [e2, t2], preconditionFn: (e3, t3) => {
            const o3 = t3.focusedNode;
            return !!o3 && !e3.isReadOnly() && !e3.isDragging() && !n.getFocusManager().ephemeralFocusTaken() && c(o3);
          }, callback: (e3, t3, o3, r2) => {
            t3.preventDefault();
            const s2 = r2.focusedNode;
            if (!s2 || !c(s2) || !n.isCopyable(s2)) return false;
            const i2 = s2.toCopyData();
            if (!i2) return false;
            if (s2 instanceof n.BlockSvg) s2.checkAndDelete();
            else if (n.isDeletable(s2)) {
              const e4 = n.Events.getGroup();
              n.Events.setGroup(true), s2.dispose(), n.Events.setGroup(e4);
            }
            return localStorage.setItem(this.localStorageKey, JSON.stringify(i2)), true;
          } };
          n.ShortcutRegistry.registry.register(o2);
        }
        blockPasteFromStorageShortcut(e2) {
          const t2 = n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.V, [n.utils.KeyCodes.CTRL]), o2 = n.ShortcutRegistry.registry.createSerializedKey(n.utils.KeyCodes.V, [n.utils.KeyCodes.META]), r2 = { name: n.ShortcutItems.names.PASTE, keyCodes: [t2, o2], preconditionFn: (e3) => {
            const t3 = e3.isFlyout ? e3.targetWorkspace : e3;
            return !!t3 && this.pastePrecondition(t3) === i.ENABLED;
          }, callback: (t3, o3) => {
            o3.preventDefault();
            const r3 = this.getCopyData();
            if (!r3) return false;
            const s2 = t3.isFlyout ? t3.targetWorkspace : t3;
            if (!s2) return false;
            try {
              if (o3 instanceof PointerEvent) {
                const e3 = n.utils.svgMath.screenToWsCoordinates(s2, new n.utils.Coordinate(o3.clientX, o3.clientY));
                return !!n.clipboard.paste(r3, s2, e3);
              }
              return !!n.clipboard.paste(r3, s2);
            } catch (o4) {
              if (!(o4 instanceof TypeError && e2)) throw o4;
              e2();
            }
            return true;
          } };
          n.ShortcutRegistry.registry.register(r2);
        }
      }
      return s;
    })());
  }
});
export default require_dist();
//# sourceMappingURL=@blockly_plugin-cross-tab-copy-paste.js.map
